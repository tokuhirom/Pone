#!/usr/bin/env perl6
use v6;

use Pone;

sub MAIN(*@sources, :$o='pone_generated.c', Str :$e='', Bool :$run=False) {
    my $code = do {
        if $e {
            $e;
        } elsif @sources.elems > 0 {
            @sources[0].IO.slurp;
        } else {
            $*IN.slurp-rest
        }
    };

    my $pone = Pone.new;

    if $run {
        $pone.run($code);
    } else {
        my $c = $pone.compile($code);
        open($o, :w).print($c);
        say "wrote $o";
    }
}

